{% extends 'restaurant/base.html' %}

{% block title %}Réserver une table{% endblock %}

{% block content %}
<div class="reservation-container">
    <h2 class="reservation-title">Réserver une table</h2>

    {% if messages %}
      <div class="messages">
        {% for message in messages %}
          <div class="alert {% if 'error' in message.tags %}alert-error{% else %}alert-success{% endif %}">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <form method="post" id="reservationForm" class="reservation-form">
        {% csrf_token %}

        <!-- Section choix de table -->
        <div class="form-section">
            <h3>1. Choisissez votre table</h3>
            <div id="restaurant-plan">
                {% for table in tables %}
                    <div class="table" data-id="{{ table.id }}">
                        <div class="table-number">Table {{ table.number }}</div>
                        <div class="table-seats">{{ table.seats }} places</div>
                    </div>
                {% endfor %}
            </div>
            <!-- Champ caché pour stocker la table sélectionnée -->
            {{ form.table }}
        </div>

        <!-- Section date et heure -->
        <div class="form-section">
            <h3>2. Date et heure</h3>
            <div class="form-row">
                <div class="form-group">
                    {{ form.date.label_tag }}
                    {{ form.date }}
                    {% if form.date.errors %}
                        <div class="field-error">{{ form.date.errors|join:", " }}</div>
                    {% endif %}
                </div>
                <div class="form-group">
                    {{ form.time.label_tag }}
                    {{ form.time }}
                    {% if form.time.errors %}
                        <div class="field-error">{{ form.time.errors|join:", " }}</div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Erreurs globales -->
        {% if form.non_field_errors %}
            <div class="form-errors">
                {% for error in form.non_field_errors %}
                    <p class="field-error">{{ error }}</p>
                {% endfor %}
            </div>
        {% endif %}

        <button type="submit" class="btn-submit">
            Confirmer la réservation
        </button>
    </form>
</div>

<style>
/* --- Styles simplifiés pour focus sur le formulaire --- */
.reservation-container {
    max-width: 900px;
    margin: 0 auto;
    padding: 20px;
}

.reservation-title { text-align: center; margin-bottom: 25px; }

#restaurant-plan { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px,1fr)); gap: 15px; margin-bottom: 20px; }
.table { border:2px solid #ddd; padding:20px; border-radius:10px; text-align:center; cursor:pointer; transition:0.3s; }
.table:hover { border-color:#d35400; transform: translateY(-3px); }
.table.selected { background:#d35400; color:white; transform: scale(1.05); }

.form-row { display:grid; grid-template-columns:1fr 1fr; gap:20px; }
.form-group { display:flex; flex-direction:column; }
.form-group input { padding:10px; border-radius:8px; border:1px solid #ccc; font-size:1rem; }
.field-error { color:#dc3545; font-size:0.9rem; margin-top:5px; }

.btn-submit { margin-top:20px; padding:12px 20px; background:#d35400; color:white; border:none; border-radius:8px; cursor:pointer; }
.btn-submit:hover { background:#e67e22; }

@media (max-width:768px) {
    .form-row { grid-template-columns:1fr; }
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function(){
    const tables = document.querySelectorAll('.table');
    const tableInput = document.getElementById('id_table');

    tables.forEach(table => {
        table.addEventListener('click', () => {
            tables.forEach(t => t.classList.remove('selected'));
            table.classList.add('selected');
            if(tableInput){
                tableInput.value = table.dataset.id;
            }
        });
    });

    // Date min = aujourd'hui, max = +31 jours
    const dateInput = document.getElementById('id_date');
    if(dateInput){
        const today = new Date();
        const maxDate = new Date();
        maxDate.setDate(today.getDate() + 31);
        dateInput.min = today.toISOString().split('T')[0];
        dateInput.max = maxDate.toISOString().split('T')[0];
    }
});
</script>
{% endblock %}
